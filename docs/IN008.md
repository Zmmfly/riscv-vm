# RISC-V 浮点运算实现笔记
想要实现一个东西，首先得知道它是什么，有哪些特性，需要实现哪些特性

## 二进制格式
参考IN007
|  type  |    Sign     |   Exponent   | Faction(Mantissa) |
| :----: | :---------: | :----------: | :---------------: |
|  fp16  | 1b`[15:15]` | 5b`[14:10]`  |    10b`[9:0]`     |
| float  | 1b`[31:31]` | 8b`[30:23]`  |    23b`[22:0]`    |
| double | 1b`[63:63]` | 11b`[62:52]` |    52b`[51:0]`    |

## 分类
在RISC-V spec中，描述了其浮点规范遵循 `IEEE 754-2008`
依据：
1. `IEEE 754-2008`文档第25页，`5.7.2 General operations`
2. 参考1 ~ 参考6
3. `Volume1_riscv-spec-20191213.pdf` 中的 `11.3 NaN Generation and Propagation` 章节

浮点数值有以下几种分类：

1. NaN
   1. 编码
      - S: `*`
      - E: 全为 `1`
      - M: 非0任意值
   2. 子类
      1. signalingNaN
         - S: `*`
         - E: 全为 `1`
         - M: MSB为 `0`, 其余取决于实现
           - ARM: MSB为 `0`, LSB为 `1`, 其余位为 `0`, 单精度例：
           - X86: MSB为 `0`, MSB-1为 `1`, 其余位为 `0`, 单精度示例: `0x7fa00000`
      2. quietNaN
         - S: `*`
         - E: 全为 `1`
         - M: MSB为 `1`, 其余取决于实现
           - ARM: MSB为 `1`, LSB为 `1`, 其余位为 `0`
           - X86: MSB为 `1`, 其余位为 `0`, 单精度示例: `0x7fc00000`
      3. Canonical NaN
         这个是RSIC-V中定义的特例, 并且RISC-V规范中要求始终支持且应是默认模式, 详情见RISC-V规范文档
         关于这个Canonical NaN, RISC-V要求在生成NaN时作为默认实现, 可简化硬件
         - S: `1`
         - E: 全为 `1`
         - M: 除尾数除最高位为1外, 其它位全为0 
           - RISC-V: 单精度示例: `0x7fc00000`
2. negativeInfinity
   - S: `1`
   - E: 全为`1`
   - M: 全为`0`
3. negativeNormal
   - S: `1`
   - E: 不全为`0` 且 不全为`1`
   - M: `*`
4. negativeSubnormal
   - S: `1`
   - E: 全为`0`
   - M: 非全`0`任意值
5. negativeZero
   - S: `1`
   - E: 全`0`
   - M: 全`0`
6.  positiveZero
   - S: `0`
   - E: 全`0`
   - M: 全`0`
7.  positiveSubnormal
   - S: `0`
   - E: 全`0`
   - M: 非全`0`任意值
8.  positiveNormal
   - S: `0`
   - E: 不全为`0` 且 不全为`1`
   - M: `*`
9.  positiveInfinity
   - S: `0`
   - E: 全为`1`
   - M: 全为`0`


**参考**
1. https://zh.wikipedia.org/wiki/IEEE_754
2. https://en.wikipedia.org/wiki/IEEE_754-1985
3. https://en.wikipedia.org/wiki/Single-precision_floating-point_format
4. https://en.wikipedia.org/wiki/NaN
5. https://stackoverflow.com/questions/18118408/what-is-the-difference-between-quiet-nan-and-signaling-nan
6. https://blog.csdn.net/Hide_in_Code/article/details/125896007
7. https://zhuanlan.zhihu.com/p/343049681
8. https://zlogs.net/blog/20/10151300/index.html
9. https://www.cnblogs.com/alking1001/p/13461906.html
10. https://blog.csdn.net/wangpeng246300/article/details/129532697
11. https://blog.csdn.net/weixin_45500205/article/details/123661905
12. https://polarisxu.studygolang.com/posts/basic/diagram-float-point/
13. https://csbabel.wordpress.com/2009/08/19/an-intro-to-ieee-floating/
